<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.repository.movie.JoinTimeRepository">

    <!--  영화 페이지에서 상영 시간표 출력  -->
    <select id="selectTimeByMovie" parameterType="Map" resultType="JoinTime">
        SELECT tim.screen_pk,
               tim.movie_pk,
               tim.scrt_date,
               tim.scrt_stime,
               scr.scr_name,
               scr.seat_plot,
               scr.scr_tot_seat,
               th.the_name,
               (sum(book.book_youth_cnt) + sum(book.book_adult_cnt)) AS booked
        FROM screentime_tb tim, screen_tb scr, theater_tb th, booking_tb book
        WHERE tim.movie_pk= #{movie_pk}
          AND tim.scrt_date = #{date}
          AND scr.screen_pk = tim.screen_pk
          AND scr.theater_pk = th.theater_pk
          AND tim.scrtime_pk = book.scrtime_pk;
    </select>

    <!--  영화 상영 시간표 - 영화,극장,날짜에따라 반응  테스트중-->
    <select id="selectTimeByClick" parameterType="Map" resultType="JoinTime">
        SELECT tim.screen_pk,
               tim.movie_pk,
               tim.scrt_date,
               tim.scrt_stime,
               scr.scr_name,
               scr.seat_plot,
               scr.scr_tot_seat,
               th.the_name
        FROM screentime_tb tim, screen_tb scr, theater_tb th, booking_tb book
        WHERE
        <if test="movie_pk!=null">
            tim.movie_pk = #{movie_pk} AND
        </if>
        <if test="date!=null">
            tim.scrt_date = #{date} AND
        </if>
        <if test="theater_pk!=null">
            scr.theater_pk = th.theater_pk AND
        </if>
          scr.screen_pk = tim.screen_pk
    </select>

    <select id="testMovieTime" parameterType="Map" resultType="JoinTime">
        SELECT tim.screen_pk,
               tim.movie_pk,
               tim.scrt_date,
               tim.scrt_stime,
               scr.scr_name,
               scr.seat_plot,
               scr.scr_tot_seat,
               th.the_name
        FROM screentime_tb tim, screen_tb scr, theater_tb th, booking_tb book
        WHERE
            scr.screen_pk = tim.screen_pk
            AND scr.theater_pk = th.theater_pk
            <if test="movie_pk!=null">
                AND tim.movie_pk = #{movie_pk}
            </if>
            <if test="date!=null">
                AND tim.scrt_date = #{date}
            </if>
            <if test="theater_pk!=null">
                AND theater_pk = #{theater_pk}
            </if>
    </select>
</mapper>
